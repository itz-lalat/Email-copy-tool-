<!DOCTYPE html>
<html>
<head>
  <title>Gmail Copy Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px) saturate(1.2);
      margin-top: 20px;
      margin-bottom: 20px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.3),
        0 8px 32px rgba(99, 102, 241, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      padding: 32px 28px 28px 28px;
      max-width: 1000px;
      width: 95vw;
      min-height: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 1.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    }
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(40px) scale(0.95); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }
    .modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(30, 41, 59, 0.35);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(7px) saturate(1.2);
  transition: background 0.3s;
}

.modal {
  background: rgba(255, 255, 255, 0.82);
  border-radius: 22px;
  padding: 38px 32px 32px 32px;
  max-width: 410px;
  width: 92vw;
  box-shadow: 0 12px 48px 0 rgba(30, 41, 59, 0.18), 0 1.5px 8px 0 rgba(99, 102, 241, 0.10);
  animation: modalSlideIn 0.38s cubic-bezier(.4,1.4,.6,1);
  position: relative;
  border: 1.5px solid rgba(99, 102, 241, 0.10);
  backdrop-filter: blur(10px) saturate(1.2);
}

@keyframes modalSlideIn {
  from { opacity: 0; transform: translateY(-60px) scale(0.92); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 18px;
}

.modal-icon {
  font-size: 2.2rem;
  background: linear-gradient(135deg, #6366f1 0%, #60a5fa 100%);
  color: #fff;
  border-radius: 14px;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 10px;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.13);
}

.modal-close {
  position: absolute;
  top: 18px;
  right: 18px;
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #64748b;
  cursor: pointer;
  transition: color 0.2s, transform 0.15s;
  z-index: 2;
  padding: 2px 6px;
  border-radius: 50%;
}
.modal-close:hover {
  color: #6366f1;
  background: #f1f5f9;
  transform: scale(1.13);
}

.modal-input {
  width: 100%;
  padding: 14px 18px;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  font-size: 1.08rem;
  margin-bottom: 18px;
  transition: border-color 0.2s, box-shadow 0.2s;
  box-sizing: border-box;
  background: rgba(243, 244, 246, 0.85);
  color: #23233b;
  outline: none;
  box-shadow: 0 1.5px 8px rgba(99, 102, 241, 0.07);
}
.modal-input:focus {
  border: 2px solid #6366f1;
  box-shadow: 0 2px 12px rgba(99, 102, 241, 0.13);
}

.modal-btn {
  padding: 12px 28px;
  border: none;
  border-radius: 8px;
  font-size: 1.05rem;
  font-weight: 600;
  cursor: pointer;
  background: linear-gradient(90deg, #6366f1 0%, #60a5fa 100%);
  color: white;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.10);
  transition: background 0.3s, transform 0.15s, box-shadow 0.3s;
  outline: none;
  margin-top: 2px;
}
.modal-btn:active {
  transform: scale(0.97);
}
.modal-btn:focus {
  outline: 2px solid #6366f1;
}

.error-message {
  color: #ef4444;
  font-size: 0.95rem;
  margin-top: -10px;
  margin-bottom: 15px;
  display: none;
  text-align: center;
  background: #fef2f2;
  border-radius: 6px;
  padding: 6px 0;
}
    .header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 12px;
      position: relative;
    }
    
    .header-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #60a5fa 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.6rem;
      box-shadow: 
        0 6px 20px rgba(99, 102, 241, 0.25),
        0 3px 10px rgba(139, 92, 246, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .header-icon::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    h2 {
      margin: 0;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
      position: relative;
    }
    
    h2::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #6366f1, #8b5cf6, #60a5fa);
      border-radius: 1px;
      transform: scaleX(0);
      animation: titleUnderline 1.5s ease-out 0.5s forwards;
    }
    
    @keyframes titleUnderline {
      to { transform: scaleX(1); }
    }
    .subtitle {
      color: #64748b;
      font-size: 1rem;
      margin-bottom: 20px;
      margin-top: 6px;
      text-align: center;
      font-weight: 500;
      letter-spacing: 0.2px;
      line-height: 1.5;
      max-width: 500px;
      opacity: 0;
      animation: fadeInUp 1s ease-out 0.8s forwards;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .button-group {
      display: flex;
      flex-direction: row;
      gap: 20px;
      margin-bottom: 20px;
      margin-top: 12px;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
      opacity: 0;
      animation: fadeInUp 1s ease-out 1.2s forwards;
    }
    @media (max-width: 600px) {
      .button-group {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
      }
    }
    .copy-btn {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #60a5fa 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 28px;
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      cursor: pointer;
      box-shadow: 
        0 6px 20px rgba(99, 102, 241, 0.25),
        0 3px 10px rgba(139, 92, 246, 0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      min-width: 140px;
    }
    
    .copy-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .copy-btn:hover::before {
      left: 100%;
    }
    .reset-btn {
      background: linear-gradient(135deg, #ef4444 0%, #f97316 50%, #fbbf24 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 28px;
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      cursor: pointer;
      box-shadow: 
        0 6px 20px rgba(239, 68, 68, 0.25),
        0 3px 10px rgba(249, 115, 22, 0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      min-width: 140px;
    }
    
    .reset-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .reset-btn:hover::before {
      left: 100%;
    }
    .export-btn {
      background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 50%, #22d3ee 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 28px;
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      cursor: pointer;
      box-shadow: 
        0 6px 20px rgba(20, 184, 166, 0.25),
        0 3px 10px rgba(6, 182, 212, 0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      min-width: 140px;
    }
    
    .export-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .export-btn:hover::before {
      left: 100%;
    }
    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 32px rgba(99, 102, 241, 0.35),
        0 6px 16px rgba(139, 92, 246, 0.25);
    }
    
    .copy-btn:active {
      transform: scale(0.98) translateY(0);
    }
    
    .copy-btn:disabled {
      background: #cbd5e1;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    .reset-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 32px rgba(239, 68, 68, 0.35),
        0 6px 16px rgba(249, 115, 22, 0.25);
    }
    
    .reset-btn:active {
      transform: scale(0.98) translateY(0);
    }
    
    .reset-btn:disabled {
      background: #cbd5e1;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 32px rgba(20, 184, 166, 0.35),
        0 6px 16px rgba(6, 182, 212, 0.25);
    }
    
    .export-btn:active {
      transform: scale(0.98) translateY(0);
    }
    .copied-flash {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%);
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      animation: flash 1.2s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
      box-shadow: 
        0 8px 24px rgba(34, 211, 238, 0.3),
        0 4px 12px rgba(6, 182, 212, 0.2);
      backdrop-filter: blur(10px);
    }
    @keyframes flash {
      0% { 
        opacity: 0; 
        transform: translate(-50%, -50%) scale(0.8);
      }
      20% { 
        opacity: 1; 
        transform: translate(-50%, -50%) scale(1.1);
      }
      80% { 
        opacity: 1; 
        transform: translate(-50%, -50%) scale(1);
      }
      100% { 
        opacity: 0; 
        transform: translate(-50%, -50%) scale(0.9);
      }
    }
    textarea {
      width: 100%;
      height: 60px;
      margin-top: 12px;
      border-radius: 12px;
      border: 2px solid rgba(99, 102, 241, 0.2);
      padding: 12px 16px;
      font-size: 0.9rem;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.9) 0%, rgba(241, 245, 249, 0.9) 100%);
      backdrop-filter: blur(10px);
      resize: none;
      box-shadow: 
        0 3px 12px rgba(99, 102, 241, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 20px;
      color: #1e293b;
      line-height: 1.3;
      letter-spacing: 0.2px;
      font-weight: 500;
    }
    
    textarea:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 
        0 8px 24px rgba(99, 102, 241, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transform: translateY(-1px);
    }
    
    /* Style for the email content in textarea */
    textarea::placeholder {
      color: #94a3b8;
      font-style: italic;
      font-weight: 400;
    }
    
    /* Custom scrollbar for textarea */
    textarea::-webkit-scrollbar {
      width: 6px;
    }
    
    textarea::-webkit-scrollbar-track {
      background: rgba(241, 245, 249, 0.5);
      border-radius: 3px;
    }
    
    textarea::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border-radius: 3px;
    }
    
    textarea::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5b21b6, #7c3aed);
    }
    
    /* Email Chips Container */
    .email-chips-container {
      width: 100%;
      height: 80px;
      margin-top: 12px;
      margin-bottom: 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.9) 0%, rgba(241, 245, 249, 0.9) 100%);
      backdrop-filter: blur(10px);
      box-shadow: 
        0 3px 12px rgba(99, 102, 241, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    

    
    .email-chips {
      display: flex;
      flex-direction: column;
      gap: 0px;
      padding: 1px 1px;
      height: 97%;
      overflow: hidden;
      justify-content: center;
      align-items: center;
    }
    
    .email-chips-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      height: 50%;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
    }
    
    .email-chips-row::-webkit-scrollbar {
      height: 3px;
    }
    
    .email-chips-row::-webkit-scrollbar-track {
      background: rgba(241, 245, 249, 0.5);
      border-radius: 2px;
    }
    
    .email-chips-row::-webkit-scrollbar-thumb {
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      border-radius: 2px;
    }
    
    .email-chips-row::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(90deg, #5b21b6, #7c3aed);
    }
    
    .email-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 16px;
      font-size: 0.75rem;
      font-family: 'Inter', sans-serif;
      color: #1e293b;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s ease;
      animation: chipSlideIn 0.3s ease-out;
      position: relative;
      flex-shrink: 0;
    }
    
    .email-chip:hover {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
    }
    

    
    .email-chip-number {
      font-size: 0.7rem;
      color: #6366f1;
      font-weight: 600;
      background: rgba(99, 102, 241, 0.1);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .email-chip-address {
      color: #1e293b;
      font-weight: 500;
    }
    

    
    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      color: #94a3b8;
      font-style: italic;
      font-weight: 400;
      font-size: 0.9rem;
    }
    
    @keyframes chipSlideIn {
      from {
        opacity: 0;
        transform: translateX(-20px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }
    .list-header {
      width: 100%;
      display: flex;
      flex-direction: row;
      align-items: center;
      font-size: 1.1rem;
      font-weight: 700;
      color: #6366f1;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 16px 16px 0 0;
      border-bottom: 2px solid rgba(99, 102, 241, 0.2);
      padding: 16px 0 16px 0;
      margin-bottom: 0;
      letter-spacing: 0.2px;
      box-shadow: 
        0 2px 8px rgba(99, 102, 241, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .list-header .col-email {
      flex: 2.5;
      padding-left: 20px;
    }
    .list-header .col-account {
      flex: 1.5;
      text-align: left;
      padding-left: 18px;
    }
    .scroll-columns {
      display: flex;
      width: 100%;
      border-radius: 0 0 16px 16px;
      box-shadow: 
        0 6px 20px rgba(99, 102, 241, 0.1),
        0 3px 10px rgba(0, 0, 0, 0.05);
      background: rgba(248, 250, 252, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(99, 102, 241, 0.1);
      border-top: none;
      height: 400px; /* Show 10 rows (each ~40px) */
      overflow: hidden;
      position: relative;
    }
    
    .scroll-columns::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.2), transparent);
    }
    .email-col, .account-col {
      overflow-y: auto;
      overflow-x: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
      /* Scrollbar styling for both columns */
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 #f8fafc;
    }
    .email-col {
      flex: 1.6;
      border-right: 1px solid #e5e7eb;
      background: #f8fafc;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0px;
      width: 100%;
      height: 100%;
      overflow-y: auto;
    }
    .account-col {
      flex: 1.5;
      background: #f8fafc;
    }
    .gmail-item {
      padding: 10px 14px;
      font-size: 0.95rem;
      color: #1e293b;
      border-left: 4px solid transparent;
      outline: none;
      display: flex;
      align-items: center;
      background: transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0.95;
      min-height: 40px;
      border-bottom: 1px solid rgba(99, 102, 241, 0.1);
      box-sizing: border-box;
      width: 100%;
      word-break: break-all;
      gap: 14px;
      position: relative;
      font-weight: 500;
    }
    
    .gmail-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    .row-number {
      font-size: 0.9rem;
      color: #6366f1;
      font-weight: 600;
      min-width: 32px;
      text-align: right;
      user-select: none;
      opacity: 0.8;
    }
    .gmail-item:last-child {
      border-bottom: none;
    }
    .gmail-item.used {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
      color: #166534;
      border-left: 4px solid #22c55e;
      opacity: 0.8;
    }
    
    .gmail-item.used::before {
      transform: scaleX(1);
      background: linear-gradient(135deg, #22c55e, #16a34a);
    }
    
    .gmail-item.current {
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);
      color: #b45309;
      border-left: 4px solid #facc15;
      font-weight: 600;
      transform: scale(1.02);
      opacity: 1;
      box-shadow: 
        0 8px 24px rgba(250, 204, 21, 0.2),
        0 4px 12px rgba(245, 158, 11, 0.15);
      animation: pop 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .gmail-item.current::before {
      transform: scaleX(1);
      background: linear-gradient(135deg, #facc15, #f59e0b);
    }
    @keyframes pop {
      0% { transform: scale(0.95); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1.02); }
    }
    .gmail-item:hover, .gmail-item:focus {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      color: #3730a3;
      transform: scale(1.01) translateY(-1px);
      opacity: 1;
      cursor: pointer;
      outline: 2px solid #6366f1;
      z-index: 1;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    }
    
    .gmail-item:hover::before, .gmail-item:focus::before {
      transform: scaleX(1);
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
    }
    .gmail-item:focus {
      outline: 2px solid #6366f1;
    }
    .account-input {
      width: 87%;
      margin: 7px 0 7px 18px;
      padding: 7px 10px;
      border-radius: 6px;
      border: 1.2px solid #cbd5e1;
      font-size: 1rem;
      background: #fff;
      color: #23233b;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 2px rgba(99, 102, 241, 0.04);
      outline: none;
      min-height: 30px;
      border-bottom: 1px solid #e5e7eb;
      display: block;
    }
    .account-input:focus {
      border: 1.5px solid #6366f1;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.10);
    }
    .account-input:last-child {
      border-bottom: none;
    }
    .account-entry-section {
      width: 100%;
      background: none;
      border-radius: 0;
      box-shadow: none;
      border: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .account-entry-label {
      font-size: 1.08rem;
      font-weight: 600;
      color: #6366f1;
      margin-bottom: 10px;
    }
    .account-entry-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    .account-entry-row {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
    }
    .account-entry-input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 6px;
      border: 1.2px solid #cbd5e1;
      font-size: 1rem;
      background: #fff;
      color: #23233b;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 2px rgba(99, 102, 241, 0.04);
      outline: none;
    }
    .account-entry-input:focus {
      border: 1.5px solid #6366f1;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.10);
    }
    .account-entry-add {
      background: linear-gradient(90deg, #22d3ee 0%, #14b8a6 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s;
      margin-left: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .account-entry-add:hover {
      background: linear-gradient(90deg, #14b8a6 0%, #22d3ee 100%);
      transform: scale(1.08);
    }
    .account-entry-delete {
      background: none;
      border: none;
      color: #f87171;
      font-size: 1.2rem;
      cursor: pointer;
      margin-left: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s, transform 0.15s;
    }
    .account-entry-delete:hover {
      color: #b91c1c;
      transform: scale(1.15);
    }
    @media (max-width: 700px) {
      .container {
        padding: 12px 2vw 12px 2vw;
        max-width: 99vw;
      }
      h2 { font-size: 1.3rem; }
      .gmail-item { font-size: 0.97rem; padding: 10px 8px; }
      .copy-btn { padding: 10px 10vw; font-size: 1rem; }
      .header-icon { width: 30px; height: 30px; font-size: 1.1rem; }
      .list-header, .scroll-columns { padding: 0 2vw; }
      .account-input { margin-left: 8px; margin-right: 8px; }
    }
    @keyframes fadeSlideIn {
      0% { opacity: 0; transform: translateY(20px) scale(0.95); }
      60% { opacity: 1; transform: translateY(-4px) scale(1.05); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(20, 184, 166, 0.3); }
      70% { box-shadow: 0 0 0 10px rgba(20, 184, 166, 0); }
      100% { box-shadow: 0 0 0 0 rgba(20, 184, 166, 0); }
    }
    .download-link {
      display: inline-block;
      margin-top: 8px;
      padding: 12px 28px;
      background: linear-gradient(90deg, #14b8a6 0%, #22d3ee 100%);
      color: #fff;
      border-radius: 8px;
      font-size: 1.08rem;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(20, 184, 166, 0.10);
      transition: background 0.3s, transform 0.15s, box-shadow 0.3s;
      letter-spacing: 0.2px;
      border: none;
      opacity: 0;
      transform: translateY(20px) scale(0.95);
      animation: fadeSlideIn 0.7s cubic-bezier(.4,1.4,.6,1) 0.05s 1 forwards, pulse 1.2s 0.7s 1;
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
    }
    .download-link:hover {
      background: linear-gradient(90deg, #0ea5e9 0%, #14b8a6 100%);
      color: #fff;
      text-decoration: none;
      transform: scale(1.06);
      box-shadow: 0 4px 16px 0 rgba(20, 184, 166, 0.18);
    }
    .download-link svg {
      width: 1.2em;
      height: 1.2em;
      margin-right: 10px;
      vertical-align: middle;
      fill: currentColor;
    }
    
    .change-user-btn {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #60a5fa 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      margin-left: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 4px 12px rgba(99, 102, 241, 0.2),
        0 2px 6px rgba(139, 92, 246, 0.15);
    }
    
    .change-user-btn:hover {
      background: linear-gradient(135deg, #5b21b6 0%, #7c3aed 50%, #6366f1 100%);
      transform: translateY(-1px) scale(1.05);
      box-shadow: 
        0 6px 16px rgba(99, 102, 241, 0.3),
        0 3px 8px rgba(139, 92, 246, 0.2);
    }
    
    .user-info {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 2px solid rgba(99, 102, 241, 0.2);
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 20px;
      font-size: 1rem;
      color: #6366f1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-weight: 600;
      box-shadow: 
        0 4px 16px rgba(99, 102, 241, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
    }
    
    /* Style for datalist suggestions */
    datalist {
      max-height: 200px;
      overflow-y: auto;
    }
    
    datalist option {
      padding: 8px 12px;
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
    }
    
    datalist option:hover {
      background: #f3f4f6;
    }
    .main-content {
      display: flex;
      flex-direction: row;
      gap: 32px;
      width: 100%;
      margin-top: 18px;
      align-items: flex-start;
    }
    .main-col {
      flex: 2.5;
      min-width: 0;
    }
    .sidebar-col {
      flex: 1.2;
      min-width: 200px;
      max-width: 300px;
      background: #f3f4f6;
      border-radius: 12px;
      box-shadow: 0 2px 10px 0 rgba(99, 102, 241, 0.07);
      padding: 16px 16px 16px 16px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    @media (max-width: 900px) {
      .main-content {
        flex-direction: column;
        gap: 18px;
      }
      .sidebar-col {
        max-width: 100vw;
        min-width: 0;
        margin-top: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Custom Modal for Reset and Export Alerts -->
  <div id="customModalOverlay" class="modal-overlay" style="display:none;">
    <div class="modal" id="customModalBox" role="dialog" aria-modal="true" aria-labelledby="customModalTitle">
      <button class="modal-close" aria-label="Close" onclick="closeCustomModal()">&times;</button>
      <div class="modal-header" id="customModalHeader">
        <!-- Icon and Title will be injected -->
      </div>
      <div id="customModalMessage" style="text-align:center;font-size:1.08rem;color:#23233b;margin-bottom:18px;"></div>
      <div id="customModalButtons" style="display:flex;justify-content:center;gap:16px;"></div>
    </div>
  </div>
    <div id="userModal" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
          <div class="modal-header">
            <div class="modal-icon">ðŸ‘¤</div>
            <h3 id="modalTitle" style="margin:0;font-size:1.35rem;font-weight:600;color:#23233b;">Enter Your Name</h3>
            <p style="color:#64748b;font-size:1.01rem;margin:6px 0 0 0;">Please enter your authorized name to access the Gmail Copy Tool</p>
          </div>
          <input type="text" id="userNameInput" class="modal-input" placeholder="Enter authorized name " autocomplete="off" list="userSuggestions" />
          <datalist id="userSuggestions">
            <!-- Suggestions will be populated dynamically -->
          </datalist>
          <div class="error-message" id="errorMessage">Please enter a valid name</div>
          <div class="modal-buttons" style="display:flex;justify-content:center;">
            <button class="modal-btn modal-btn-primary" onclick="setUserName()">Continue</button>
          </div>
        </div>
      </div>
  <div class="container" id="mainContainer" style="display: none;">
    <div class="header">
      <div class="header-icon" aria-hidden="true">ðŸ“§</div>
  <h2>Gmail Copy Tool</h2>
    </div>
    <div class="subtitle">Easily copy batches of Gmail addresses from your Google Sheet.<br>Stay organized and efficient.</div>
    <div class="user-info" id="userInfo" style="display: none;">
        ðŸ‘¤ Current User: <span id="currentUserName"></span>
        <button class="change-user-btn" onclick="changeUser()">Change User</button>
      </div>

      <div id="emailChipsContainer" class="email-chips-container">
      <div id="emailChips" class="email-chips">
        <!-- Email chips will be dynamically added here -->
      </div>
    </div>
   

    <div class="button-group">
      <button class="reset-btn" id="resetBtn" onclick="resetAll()">Reset</button>
      <button class="copy-btn" id="copyBtn" onclick="copyNext10()">
        Copy Next 10
        <span id="copiedFlash" class="copied-flash" style="display:none;">Copied!</span>
      </button>
      <!-- Export button removed from here -->
    </div>
    <div id="downloadLinkContainer"></div>
    <div class="main-content">
      <div class="main-col">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
          <label for="startRowInput" style="font-weight:500;color:#6366f1;">Start copying from row:</label>
          <input type="number" id="startRowInput" min="1" value="1" style="width:70px;padding:6px 10px;border-radius:6px;border:1.2px solid #cbd5e1;font-size:1rem;" />
        </div>
        <div class="list-header">
          <div class="col-email" style="display: flex; align-items: center; gap: 10px;">
            Email
            <button class="reset-btn" id="resetWarningBtn" type="button" style="padding: 4px 12px; font-size: 0.85rem; margin-left: 8px; height: 28px; line-height: 1; border-radius: 8px;" onclick="resetWarningCounter()">Reset Warning</button>
          </div>
        </div>
        <div class="scroll-columns">
          <div class="email-col" id="emailCol"></div>
        </div>
      </div>
      <div class="sidebar-col">
        <div class="account-entry-section">
          <div class="account-entry-label" style="display: flex; align-items: center; gap: 10px;">
            Account Names
            <button class="export-btn" id="exportBtn" type="button" style="padding: 8px 18px; font-size: 0.98rem; margin: 0 0 0 8px; height: 36px;" onclick="exportCSV()">Export</button>
          </div>
          <div class="account-entry-list" id="accountEntryList"></div>
          <button class="account-entry-add" id="addAccountBtn" type="button" onclick="addAccountEntry()">ï¼‹</button>
        </div>
      </div>
    </div>
  </div>
  <script>
   const SHEET_ID = "10deQQ6gTaw_q2h-98bG01DJeGHMmefhhklPSPhnuUNo";
let SHEET_NAME = ""; // Now dynamic
let currentUser = "";
let data = [];
let currentIndex = 0;
let lastCopiedRange = null; // [start, end)
let accountNames = {};
let totalEmailsCopied = 0; // Track total emails copied

// Modal functions
function showModal() {
  document.getElementById('userModal').style.display = 'flex';
  loadUserSuggestions(); // Load suggestions when modal opens
  document.getElementById('userNameInput').focus();
}

function hideModal() {
  document.getElementById('userModal').style.display = 'none';
}

function closeModal() {
  hideModal();
}

// Prevent clicking outside modal from closing it
document.addEventListener('DOMContentLoaded', function() {
  const modalOverlay = document.getElementById('userModal');
  if (modalOverlay) {
    modalOverlay.addEventListener('click', function(e) {
      // Only close if clicking the overlay itself, not the modal content
      if (e.target === modalOverlay) {
        // Do nothing - prevent closing
        e.preventDefault();
        e.stopPropagation();
      }
    });
  }
});

// --- Custom Modal for Reset/Export ---
function showCustomModal({ icon, title, message, buttons }) {
  const overlay = document.getElementById('customModalOverlay');
  const header = document.getElementById('customModalHeader');
  const msg = document.getElementById('customModalMessage');
  const btns = document.getElementById('customModalButtons');
  // Icon and title
  header.innerHTML = `<div class="modal-icon">${icon}</div><h3 id='customModalTitle' style='margin:0;font-size:1.18rem;font-weight:600;color:#23233b;'>${title}</h3>`;
  msg.textContent = message;
  btns.innerHTML = '';
  buttons.forEach(btn => {
    const b = document.createElement('button');
    b.className = 'modal-btn';
    b.textContent = btn.text;
    if (btn.primary) b.style.background = 'linear-gradient(90deg, #f87171 0%, #fbbf24 100%)';
    b.onclick = () => {
      closeCustomModal();
      if (btn.onClick) btn.onClick();
    };
    btns.appendChild(b);
  });
  overlay.style.display = 'flex';
  setTimeout(() => {
    // Focus first button for accessibility
    const firstBtn = btns.querySelector('button');
    if (firstBtn) firstBtn.focus();
  }, 100);
}

function closeCustomModal() {
  document.getElementById('customModalOverlay').style.display = 'none';
}

// List of authorized users
const AUTHORIZED_USERS = [
  'Lotus',
  'Rocky',
  'Benjir',
  'Lalat'
];

// Functions to manage user suggestions
function saveUserSuggestion(userName) {
  try {
    let suggestions = JSON.parse(localStorage.getItem('userSuggestions') || '[]');
    if (!suggestions.includes(userName)) {
      suggestions.push(userName);
      // Keep only last 10 suggestions to avoid clutter
      if (suggestions.length > 10) {
        suggestions = suggestions.slice(-10);
      }
      localStorage.setItem('userSuggestions', JSON.stringify(suggestions));
    }
  } catch (e) {
    console.error('Error saving user suggestion:', e);
  }
}

function loadUserSuggestions() {
  try {
    const suggestions = JSON.parse(localStorage.getItem('userSuggestions') || '[]');
    const datalist = document.getElementById('userSuggestions');
    datalist.innerHTML = '';
    
    // Add authorized users first
    AUTHORIZED_USERS.forEach(user => {
      const option = document.createElement('option');
      option.value = user;
      datalist.appendChild(option);
    });
    
    // Add saved suggestions
    suggestions.forEach(suggestion => {
      if (AUTHORIZED_USERS.includes(suggestion)) {
        const option = document.createElement('option');
        option.value = suggestion;
        datalist.appendChild(option);
      }
    });
  } catch (e) {
    console.error('Error loading user suggestions:', e);
  }
}

function setUserName() {
  const input = document.getElementById('userNameInput');
  const name = input.value.trim().toUpperCase();
  
  if (!name) {
    document.getElementById('errorMessage').style.display = 'block';
    document.getElementById('errorMessage').textContent = 'Please enter a valid name';
    return;
  }
  
  // Check if user is authorized
  if (!AUTHORIZED_USERS.includes(name)) {
    document.getElementById('errorMessage').style.display = 'block';
    document.getElementById('errorMessage').textContent = 'Access denied. You are not authorized to use this tool.';
    return;
  }
  
  // Clear any previous error
  document.getElementById('errorMessage').style.display = 'none';
  
  // Save user suggestion for future logins
  saveUserSuggestion(name);
  
  currentUser = name;
  SHEET_NAME = name;
  localStorage.setItem('currentUser', currentUser);
  
  // Load user-specific data
  currentIndex = parseInt(localStorage.getItem(`currentIndex_${currentUser}`) || "0", 10);
  totalEmailsCopied = parseInt(localStorage.getItem(`totalEmailsCopied_${currentUser}`) || "0", 10);
  
  // Load user-specific account entry list
  loadAccountEntryList();
  renderAccountEntryList();
  
  hideModal();
  
  // Show main container and user info
  document.getElementById('mainContainer').style.display = 'flex';
  document.getElementById('currentUserName').textContent = currentUser;
  document.getElementById('userInfo').style.display = 'block';
  
  loadData();
}

function changeUser() {
  const previousUser = currentUser; // Store current user before clearing
  localStorage.removeItem('currentUser');
  currentUser = "";
  SHEET_NAME = "";
  document.getElementById('mainContainer').style.display = 'none';
  document.getElementById('userInfo').style.display = 'none';
  document.getElementById('userNameInput').value = previousUser || ''; // Pre-fill with previous user
  document.getElementById('errorMessage').style.display = 'none';
  showModal();
  // Reset account entry list UI for modal
  accountEntryList = [''];
  renderAccountEntryList();
}

// Load account names from localStorage (user-specific)
function loadAccountNames() {
  try {
    accountNames = JSON.parse(localStorage.getItem(`accountNames_${currentUser}`) || "{}") || {};
  } catch {
    accountNames = {};
  }
}

// Save account names to localStorage (user-specific)
function saveAccountNames() {
  localStorage.setItem(`accountNames_${currentUser}`, JSON.stringify(accountNames));
}

async function loadData() {
  if (!SHEET_NAME) return;
  
  try {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));
    data = json.table.rows.slice(1).map(row => row.c[0]?.v || "").filter(Boolean);
    loadAccountNames();
    renderList();
    updateButtonState();
    // Update startRowInput max and value
    const startRowInput = document.getElementById('startRowInput');
    if (startRowInput) {
      startRowInput.max = data.length;
      startRowInput.value = (currentIndex + 1);
    }
  } catch (e) {
    document.getElementById("emailCol").innerHTML = `<div style='color:#ef4444;font-weight:600;'>Failed to load data for ${SHEET_NAME} ðŸ˜¢<br>${e.message}</div>`;
    document.getElementById("copyBtn").disabled = true;
  }
}

// Render only the email list (no account column)
function renderList() {
  const emailCol = document.getElementById("emailCol");
  emailCol.innerHTML = "";
  let firstCurrentEmailDiv = null;
  data.forEach((gmail, i) => {
    // Email cell
    const emailDiv = document.createElement("div");
    emailDiv.innerHTML = `<span class="row-number">${i + 1}</span><span class="email-text">${gmail}</span>`;
    emailDiv.className = "gmail-item";
    if (lastCopiedRange && i >= lastCopiedRange[0] && i < lastCopiedRange[1]) {
      emailDiv.classList.add("current");
      if (!firstCurrentEmailDiv) firstCurrentEmailDiv = emailDiv;
    } else if (i < currentIndex) {
      emailDiv.classList.add("used");
    }
    emailDiv.tabIndex = 0; // for accessibility
    emailCol.appendChild(emailDiv);
  });
  // Scroll the first current email into view at the top of the email column
  if (firstCurrentEmailDiv) {
    setTimeout(() => {
      firstCurrentEmailDiv.scrollIntoView({ block: 'start', behavior: 'smooth' });
    }, 0);
  }
}

// --- Dynamic Account Name Entry Section ---
let accountEntryList = [];

function renderAccountEntryList() {
  const list = document.getElementById('accountEntryList');
  list.innerHTML = '';
  accountEntryList.forEach((val, idx) => {
    const row = document.createElement('div');
    row.className = 'account-entry-row';
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'account-entry-input';
    input.placeholder = 'Account name...';
    input.value = val;
    input.setAttribute('aria-label', `Account name ${idx + 1}`);
    input.oninput = (e) => {
      accountEntryList[idx] = e.target.value;
      saveAccountEntryList();
    };
    row.appendChild(input);
    list.appendChild(row);
  });
}

function addAccountEntry() {
  accountEntryList.push('');
  saveAccountEntryList();
  renderAccountEntryList();
}

function saveAccountEntryList() {
  if (currentUser) {
    localStorage.setItem(`accountEntryList_${currentUser}`, JSON.stringify(accountEntryList));
  }
}

function loadAccountEntryList() {
  if (!currentUser) {
    accountEntryList = [''];
    return;
  }
  try {
    accountEntryList = JSON.parse(localStorage.getItem(`accountEntryList_${currentUser}`) || '[""]');
    if (!Array.isArray(accountEntryList) || accountEntryList.length === 0) accountEntryList = [''];
  } catch {
    accountEntryList = [''];
  }
}

function updateButtonState() {
  const btn = document.getElementById("copyBtn");
  if (currentIndex >= data.length) {
    btn.disabled = true;
    btn.textContent = "All Copied!";
  } else {
    btn.disabled = false;
    btn.textContent = "Copy Next 10";
  }
}

function showCopiedFlash() {
  const flash = document.getElementById("copiedFlash");
  flash.style.display = "block";
  flash.style.opacity = 1;
  setTimeout(() => {
    flash.style.display = "none";
  }, 1100);
}

function copyNext10() {
  if (currentIndex >= data.length) return;
  const start = currentIndex;
  const end = Math.min(currentIndex + 10, data.length);
  const next10 = data.slice(start, end);
  const joinedClipboard = next10.join("\n");
  
  navigator.clipboard.writeText(joinedClipboard).then(() => {
    // Create email chips
    createEmailChips(next10, start);
    
    lastCopiedRange = [start, end];
    currentIndex = end;
    localStorage.setItem(`currentIndex_${currentUser}`, currentIndex);
    // Track total emails copied
    totalEmailsCopied += next10.length;
    localStorage.setItem(`totalEmailsCopied_${currentUser}`, totalEmailsCopied);
    
    // Check if we need to show VPN reminder
    if (totalEmailsCopied % 300 === 0 && totalEmailsCopied > 0) {
      showVPNReminder();
    }
    
    renderList();
    updateButtonState();
    showCopiedFlash();
  });
}

function createEmailChips(emails, startIndex) {
  const chipsContainer = document.getElementById('emailChips');
  chipsContainer.innerHTML = '';
  
  // Create two rows
  const row1 = document.createElement('div');
  row1.className = 'email-chips-row';
  
  const row2 = document.createElement('div');
  row2.className = 'email-chips-row';
  
  emails.forEach((email, index) => {
    const emailNumber = startIndex + index + 1;
    const chip = document.createElement('div');
    chip.className = 'email-chip';
    chip.innerHTML = `
      <span class="email-chip-number">${emailNumber}</span>
      <span class="email-chip-address">${email}</span>
    `;
    
    // Distribute chips between rows (first 5 in row1, next 5 in row2)
    if (index < 5) {
      row1.appendChild(chip);
    } else {
      row2.appendChild(chip);
    }
  });
  
  chipsContainer.appendChild(row1);
  chipsContainer.appendChild(row2);
  
  // Scroll to the end to show new chips
  setTimeout(() => {
    row1.scrollLeft = row1.scrollWidth;
    row2.scrollLeft = row2.scrollWidth;
  }, 100);
}

function removeEmailChip(chipElement) {
  chipElement.parentElement.remove();
  
  // Show empty state if no chips left
  const chipsContainer = document.getElementById('emailChips');
  if (chipsContainer.children.length === 0) {
    chipsContainer.innerHTML = '<div class="empty-state">Copied emails will appear here...</div>';
  }
}

function clearEmailChips() {
  const chipsContainer = document.getElementById('emailChips');
  chipsContainer.innerHTML = '<div class="empty-state">Copied emails will appear here...</div>';
}

function showVPNReminder() {
  showCustomModal({
    icon: 'ðŸ”’',
    title: 'VPN Reminder',
    message: `You've copied 300 emails. Please change your VPN for security.`,
    buttons: [
      { text: 'OK', onClick: null }
    ]
  });
}

function resetAll() {
  showCustomModal({
    icon: 'âš ï¸',
    title: 'Reset All Data',
    message: 'Are you sure you want to reset all progress and account names? This cannot be undone.',
    buttons: [
      { text: 'Cancel', onClick: null },
      { text: 'Reset', primary: true, onClick: () => {
        // Remove user-specific data
        localStorage.removeItem(`currentIndex_${currentUser}`);
        localStorage.removeItem(`accountNames_${currentUser}`);
        localStorage.removeItem(`accountEntryList_${currentUser}`);
        localStorage.removeItem(`totalEmailsCopied_${currentUser}`);
        currentIndex = 0;
        lastCopiedRange = null;
        accountNames = {};
        accountEntryList = [''];
        totalEmailsCopied = 0;
        clearEmailChips();
        renderList();
        renderAccountEntryList();
        loadData();
        updateButtonState();
        // Reset startRowInput
        const startRowInput = document.getElementById('startRowInput');
        if (startRowInput) startRowInput.value = 1;
      } }
    ]
  });
}

// Export CSV function (global scope)
function exportCSV() {
  // Gather only non-empty account names, in order
  const lines = accountEntryList.map(name => name.trim()).filter(name => name !== '');
  if (lines.length === 0) {
    showCustomModal({
      icon: 'â„¹ï¸',
      title: 'No Data to Export',
      message: 'There are no account names to export. Please add at least one account name.',
      buttons: [
        { text: 'OK', onClick: null }
      ]
    });
    return;
  }
  const txt = lines.join('\n');
  const blob = new Blob([txt], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  // Get BD time for filename
  const now = new Date();
  const options = { timeZone: 'Asia/Dhaka', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: true };
  let bdString = now.toLocaleString('en-US', options);
  // Format: MM/DD/YYYY, HH:MM AM/PM
  let [date, time] = bdString.split(', ');
  let [month, day, year] = date.split('/');
  let [hm, ampm] = time.split(' ');
  let [hour, minute] = hm.split(':');
  // Pad and format
  const filename = `account_names_${currentUser}_${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}_${hour.padStart(2, '0')}-${minute}${ampm.toLowerCase()}.txt`;
  // Direct download (no extra button)
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    URL.revokeObjectURL(url);
    document.body.removeChild(a);
  }, 200);
}

function resetWarningCounter() {
  showCustomModal({
    icon: 'âš ï¸',
    title: 'Reset VPN Warning Counter',
    message: 'Are you sure you want to reset the VPN warning counter? This will allow you to copy another 300 emails before seeing the VPN reminder.',
    buttons: [
      { text: 'Cancel', onClick: null },
      { text: 'Reset', primary: true, onClick: () => {
        totalEmailsCopied = 0;
        if (currentUser) {
          localStorage.setItem(`totalEmailsCopied_${currentUser}`, "0");
        }
        showCustomModal({
          icon: 'âœ…',
          title: 'Counter Reset',
          message: 'VPN warning counter has been reset!',
          buttons: [{ text: 'OK', onClick: null }]
        });
      }}
    ]
  });
}

// Initialize on page load
window.onload = function() {
  // Set window size to 80% on startup
  if (window.screen && window.screen.availWidth && window.screen.availHeight) {
    const width = Math.round(window.screen.availWidth * 0.8);
    const height = Math.round(window.screen.availHeight * 0.8);
    const left = Math.round((window.screen.availWidth - width) / 2);
    const top = Math.round((window.screen.availHeight - height) / 2);
    
    window.resizeTo(width, height);
    window.moveTo(left, top);
  }
  
  const savedUser = localStorage.getItem('currentUser');
  if (savedUser && AUTHORIZED_USERS.includes(savedUser)) {
    currentUser = savedUser;
    SHEET_NAME = savedUser;
    currentIndex = parseInt(localStorage.getItem(`currentIndex_${currentUser}`) || "1", 10);
    totalEmailsCopied = parseInt(localStorage.getItem(`totalEmailsCopied_${currentUser}`) || "0", 10);
    
    // Show main container and user info
    document.getElementById('mainContainer').style.display = 'flex';
    document.getElementById('currentUserName').textContent = currentUser;
    document.getElementById('userInfo').style.display = 'block';
    
    loadData();
  } else {
    // Clear any unauthorized saved user
    if (savedUser && !AUTHORIZED_USERS.includes(savedUser)) {
      localStorage.removeItem('currentUser');
    }
    showModal();
  }
  
  loadAccountEntryList();
  renderAccountEntryList();
  
  // Initialize empty state for email chips
  clearEmailChips();
  
  // Add Enter key support for modal
  const userInput = document.getElementById('userNameInput');
  if (userInput) {
    userInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        setUserName();
      }
    });
  }

  // Start Row Input logic
  const startRowInput = document.getElementById('startRowInput');
  if (startRowInput) {
    // Set initial value from localStorage/currentIndex
    let idx = parseInt(localStorage.getItem(`currentIndex_${currentUser}`) || '0', 10);
    startRowInput.value = (idx + 1);
    startRowInput.addEventListener('change', function() {
      let val = parseInt(this.value, 10);
      if (isNaN(val) || val < 1) val = 1;
      if (data && data.length && val > data.length) val = data.length;
      currentIndex = val - 1;
      localStorage.setItem(`currentIndex_${currentUser}`, currentIndex);
      lastCopiedRange = null;
      renderList();
      updateButtonState();
              clearEmailChips();
    });
  }
};
  </script>
</body>
</html>

